---
import ArticleNavigationButton from "../components/PageContent/ArticleNavigationButton.astro";
import { getTutorialNav } from "../i18n/util";
import { getLanguageFromURL } from "../util";
import MainLayout from "./MainLayout.astro";

const url = new URL(Astro.request.url);
const currentPage = url.pathname;
const lang = getLanguageFromURL(Astro.canonicalURL.pathname);

interface SimpleNavItem { text: string; slug: string; }
const navItems = await getTutorialNav(Astro);
const pageLinks = navItems.filter(item => !('header' in item) && item.slug) as SimpleNavItem[];
const index = pageLinks.findIndex((link) => currentPage.endsWith(link.slug + '/'));
const makeLinkItem = ({ text, slug }: SimpleNavItem) => ({ text, link: `/${lang}/${slug}/` });
let next, previous;
if (index > 0) previous = makeLinkItem(pageLinks[index - 1]);
if (index !== -1 && index < pageLinks.length - 1) next = makeLinkItem(pageLinks[index + 1]);
---

<MainLayout {...Astro.props}>
	<slot />
	<aside class="next-previous-nav">
		{previous &&
		<ArticleNavigationButton rel="prev" item={previous} />}
		{next &&
		<ArticleNavigationButton rel="next" item={next} />}
	</aside>
</MainLayout>

<style>
	.next-previous-nav {
		display: flex;
		flex-wrap: wrap;
		width: auto;
		gap: 1rem;
		margin-bottom: 1.5rem;
	}
</style>
