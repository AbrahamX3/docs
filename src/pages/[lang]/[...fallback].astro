---
import languages from '../../i18n/languages';

export async function getStaticPaths() {
	const allPages = await Astro.glob('../**/*.md');
	const pagesByLang = allPages.reduce((pages, page) => {
		const lang = page.url.split('/')[1];
		if (!pages[lang]) pages[lang] = [];
		pages[lang].push(page);
		return pages;
	}, {} as { [lang: string]: typeof allPages });

	const paths = [];
	for (const englishPageContent of pagesByLang.en) {
		const slug = englishPageContent.url.slice(4);
		for (const lang of Object.keys(languages)) {
			if (lang === 'en') continue;
			const translatedPageContent = pagesByLang[lang]?.find(p => p.url.endsWith(slug));
			paths.push({ params: { lang, fallback: slug }, props: {content: translatedPageContent || englishPageContent} });
		}
	}
	return paths;
}

const {content} = Astro.props;
const Content = content.Content;
---
<Content />
